<app-navbar>
    <main>
        <h1 class="title">Transferir dinero</h1>
        <section
            *ngIf="!this.selectedUser"
            class="list-section"
        >
            <h2>¿A quién le querés transferir?</h2>
            <ul class="unordered-list">
                <li
                    *ngFor="let user of this.otherUsers; let i = index"
                    class="list-item" 
                    [ngClass]="{'odd-user-container': i % 2 !== 0}"
                    (click)="this.onUserClick(user)"
                >
                    <div class="image-container">
                        <img
                            class="user-image"
                            [src]="
                                user.profilePictureURL ||
                                'https://i.pravatar.cc/150?img=26'
                            "
                            alt="Other user's picture"
                        >
                    </div>
                    <p class="fullname-container">
                        <span>
                            {{user.firstName}}
                        </span>
                        <span>
                            {{user.lastName}}
                        </span>
                    </p>
                    <p class="email-container">
                        <span class="user-email">
                            {{user.email}}
                        </span>
                    </p>
                    <div class="transfer-sign-container">
                        <p>
                            Transferir
                        </p>
                    </div>
                </li>
            </ul>
        </section>
        <section
            *ngIf="
                this.selectedUser &&
                !this.isConfirmSection
            "
            class="input-section"
        >
            <h2>Vas a transferirle a</h2>
            <div class="selected-user">
                <div class="image-container">
                    <img
                        class="user-image"
                        [src]="
                            this.selectedUser.profilePictureURL ||
                            'https://i.pravatar.cc/150?img=26'
                        "
                        alt="Other user's picture"
                    >
                </div>
                <div class="selected-user-info">
                    <p class="fullname-container">
                        <span>
                            {{this.selectedUser.firstName}}
                        </span>
                        <span>
                            {{this.selectedUser.lastName}}
                        </span>
                    </p>
                    <p class="email-container">
                        <span class="user-email">
                            {{this.selectedUser.email}}
                        </span>
                    </p>
                </div>
            </div>
            <div>
                <h4 class="amount-title">Monto:</h4>
                <mat-form-field appearance="outline">
                    <mat-label>ARS</mat-label>
                    <input
                        matInput
                        type="number"
                        [formControl]="transferAmount"
                    >
                    <span matTextPrefix>$&nbsp;</span>
                </mat-form-field>
                <div class="error-container">
                    <p class="error" *ngIf="this.notEnoughBalanceError">
                        Error: saldo insuficiente.
                    </p>
                    <p class="error" *ngIf="
                        this.transferAmount.touched &&
                        this.transferAmountNotDefinedError
                    ">
                        Ingresa un monto.
                    </p>
                    <p class="error" *ngIf="this.invalidTransferAmountError">
                        Error: valor inválido.
                    </p>
                </div>
            </div>
            <div>
                <h4>Tu saldo actual:</h4>
                <p class="balance">$ {{this.strBalance}}</p>
            </div>
            <button
                mat-raised-button
                color="primary"
                [disabled]="
                    this.transferAmount.pristine ||
                    this.notEnoughBalanceError ||
                    this.transferAmountNotDefinedError ||
                    this.invalidTransferAmountError
                "
                (click)="onContinueClick()"
            >
                Continuar
            </button>
        </section>
        
        <section
            *ngIf="this.isConfirmSection"
            class="confirm-section"
        >
            <h2>Revisa los datos</h2>
            <h4 class="receiver-title">Destinatario:</h4>
            <div class="selected-user">
                <div class="image-container">
                    <img
                        class="user-image"
                        [src]="
                            this.selectedUser.profilePictureURL ||
                            'https://i.pravatar.cc/150?img=26'
                        "
                        alt="Other user's picture"
                    >
                </div>
                <div class="selected-user-info">
                    <p class="fullname-container">
                        <span>
                            {{this.selectedUser.firstName}}
                        </span>
                        <span>
                            {{this.selectedUser.lastName}}
                        </span>
                    </p>
                    <p class="email-container">
                        <span class="user-email">
                            {{this.selectedUser.email}}
                        </span>
                    </p>
                </div>
            </div>
            <p class="entered-amount">
                Monto: $ {{this.transferAmount.value}}
            </p>
            <h4 class="confirm-question">
                ¿Confirmas la operación?
            </h4>
            <div class="confirm-buttons">
                <button
                    mat-raised-button
                    color="warn"
                    (click)="onCancelClick()"
                >
                    Cancelar
                </button>            
                <button
                    mat-raised-button
                    color="primary"
                    (click)="onConfirmClick()"
                >
                    Aceptar
                </button>
            </div>
        </section>
        <div class="spinner-or-error">
            <mat-spinner *ngIf="this.isLoading" diameter="40"/>
            <p *ngIf="!this.isLoading">
            {{this.errorMessage}}
            </p>
        </div>
    </main>
</app-navbar>
